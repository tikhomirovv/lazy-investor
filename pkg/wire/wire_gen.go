// Code generated by Wire. DO NOT EDIT.
//go:generate go run -mod=mod github.com/google/wire/cmd/wire ./pkg/wire
//go:build !wireinject
// +build !wireinject

package wire

import (
	"os"

	"github.com/tikhomirovv/lazy-investor/internal/adapters/marketdata/tinkoff"
	"github.com/tikhomirovv/lazy-investor/internal/adapters/report/chart"
	"github.com/tikhomirovv/lazy-investor/internal/application"
	"github.com/tikhomirovv/lazy-investor/pkg/config"
	"github.com/tikhomirovv/lazy-investor/pkg/logging"
)

const configPath = "./config.yml"

func providerConfigPath() string {
	return configPath
}

func providerTinkoffConfig() tinkoff.Config {
	return tinkoff.Config{
		AppName: os.Getenv("APP_NAME"),
		Host:    os.Getenv("TINKOFF_API_HOST"),
		Token:   os.Getenv("TINKOFF_API_TOKEN"),
	}
}

// InitConfig returns config from YAML file.
func InitConfig() (*config.Config, error) {
	path := providerConfigPath()
	return config.NewConfig(path)
}

// InitLogger returns the default zerolog-based logger.
func InitLogger() *logging.ZLogger {
	return logging.NewLogger()
}

// InitTinkoffService builds Tinkoff market data adapter.
func InitTinkoffService(logger logging.Logger) (*tinkoff.Service, error) {
	cfg := providerTinkoffConfig()
	return tinkoff.NewService(cfg, logger)
}

// InitApplication builds the main application with all adapters.
func InitApplication() (*application.Application, error) {
	path := providerConfigPath()
	cfg, err := config.NewConfig(path)
	if err != nil {
		return nil, err
	}
	zLogger := logging.NewLogger()
	tinkoffCfg := tinkoff.Config{
		AppName: os.Getenv("APP_NAME"),
		Host:    os.Getenv("TINKOFF_API_HOST"),
		Token:   os.Getenv("TINKOFF_API_TOKEN"),
	}
	tinkoffSvc, err := tinkoff.NewService(tinkoffCfg, zLogger)
	if err != nil {
		return nil, err
	}
	chartSvc := chart.NewService()
	app := application.NewApplication(cfg, zLogger, tinkoffSvc, chartSvc)
	return app, nil
}
